Построим формулу, которую решим солвером Z3. 

Для каждой точки у нас может быть больше двух возможных расположений меток:
1) Добавим условие, что только одна из них должна быть выбрана. 
Условие для переменных $x_1, x_2, x_3$ выглядит так: $(\overline{x_1}\overline{x_2}x_3 + \overline{x_1}x_2\overline{x_3} + {x_1} \overline{x_2}\overline{x_3})$.
Для случая более трех переменных обобщается тривиально.

2) Если находим какое-то пересечение двух меток $x_1, x_2$, то запрещаем его с помощью условия $\overline{x_1}x_2 + x_1\overline{x_2} + \overline{x_1}\overline{x_2}$ 

Переменные кодируем следующим образом: `номер_точки$номер_метки`